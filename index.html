<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Americano M3 & Friends</title>
<style>
  :root{
    --m3:#0d2849;
    --accent:#ffd400;
    --bg:#f6f8fb;
  }
  *{box-sizing:border-box}
  body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:24px; background:var(--bg); color:#1f2d3d;}
  header{display:flex; align-items:center; gap:16px; justify-content:center; margin-bottom:16px;}
  header img{height:56px;}
  h1{margin:0; font-size:28px; color:var(--m3); letter-spacing:.5px;}
  .tag{display:inline-block; margin-top:6px; padding:4px 10px; background:var(--m3); color:white; border-radius:999px; font-size:12px;}
  .intro{max-width:900px; margin:12px auto 24px; text-align:center; font-size:16px;}
  table{width:100%; border-collapse:collapse; margin:24px 0; background:white; border-radius:10px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,.06)}
  th, td{padding:10px 12px; border-bottom:1px solid #eef2f7; text-align:left;}
  th{background:var(--m3); color:white; text-transform:uppercase; font-size:12px; letter-spacing:.08em;}
  tr:last-child td{border-bottom:none;}
  .round{margin:28px auto; max-width:1100px;}
  .round h2{color:var(--m3); font-size:20px; margin:6px 0 8px;}
  #voterName{display:block; margin:0 auto; padding:10px 14px; font-size:16px; width:min(420px,90%); border:1px solid #ced7e0; border-radius:8px; background:white;}
  button{display:block; margin:18px auto; padding:12px 18px; font-size:16px; background:var(--m3); color:white; border:none; border-radius:8px; cursor:pointer;}
  button:hover{filter:brightness(1.05);}
  .match-label{display:flex; gap:16px; align-items:center;}
  .court{font-weight:600; color:#445; min-width:85px;}
  .time{font-family:monospace; background:#edf2ff; padding:2px 6px; border-radius:6px; border:1px solid #d9e3ff;}
  #rankingContainer table{width:100%; border-collapse:collapse; margin-top:8px;}
  #rankingContainer th, #rankingContainer td{padding:8px 10px; border-bottom:1px solid #eef2f7;}
  .hidden{display:none;}
  /* Carrusel */
  .carousel {
    display:flex; align-items:center; justify-content:center; gap:12px;
    background:#fff; padding:12px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,.06);
    max-width:900px; margin:0 auto;
  }
  .carousel img { max-width:720px; max-height:420px; width:100%; height:auto; border-radius:8px; object-fit:cover; }
  .carousel button{ padding:8px 12px; font-size:18px; border:none; border-radius:8px; background:var(--m3); color:#fff; cursor:pointer; }
  .carousel button:hover{ filter:brightness(1.05); }
</style>
</head>
<body>
  <header>
      <img src="pictures/m3-logo.jpg" alt="M3 Logo">
    <div>
      <h1>Americano M3 & Friends</h1>
      <div class="tag">Bienvenid@s y que gane la mejor âš¡</div>
    </div>
  </header>

  <p class="intro">
    Vota quiÃ©n gana en cada partido. Si te equivocas, nadie se entera; si aciertas, lo gritamos ðŸ˜‰.
    Escribe tu nombre, selecciona tus ganadoras y envÃ­a tu voto.
  </p>

  <input type="text" id="voterName" placeholder="Ingresa tu nombre" required />

  <!-- Franjas y partidos -->
  <div class="round"><h2>Franja 18:05-18:30</h2><table><tr><th>Cancha</th><th>Partido</th><th>Tu voto</th></tr>
      <tr>
        <td class="court">Cancha 1</td>
        <td><span class="time">18:05-18:30</span> â€” Coni Dalal <strong>vs</strong> Isa Dani Torres</td>
        <td>
          <label class="match-label"><input type="radio" name="match1" value="Coni Dalal"> Coni Dalal</label>
          <label class="match-label"><input type="radio" name="match1" value="Isa Dani Torres"> Isa Dani Torres</label>
        </td>
      </tr>

      <tr>
        <td class="court">Cancha 2</td>
        <td><span class="time">18:05-18:30</span> â€” Vale H Isi <strong>vs</strong> Cata Flo</td>
        <td>
          <label class="match-label"><input type="radio" name="match2" value="Vale H Isi"> Vale H Isi</label>
          <label class="match-label"><input type="radio" name="match2" value="Cata Flo"> Cata Flo</label>
        </td>
      </tr>

      <tr>
        <td class="court">Cancha 3</td>
        <td><span class="time">18:05-18:30</span> â€” Nata Fi <strong>vs</strong> Pia MaÃ±i</td>
        <td>
          <label class="match-label"><input type="radio" name="match3" value="Nata Fi"> Nata Fi</label>
          <label class="match-label"><input type="radio" name="match3" value="Pia MaÃ±i"> Pia MaÃ±i</label>
        </td>
      </tr>
    </table></div>

  <div class="round"><h2>Franja 18:35 - 19:00</h2><table><tr><th>Cancha</th><th>Partido</th><th>Tu voto</th></tr>
      <tr>
        <td class="court">Cancha 1</td>
        <td><span class="time">18:35 - 19:00</span> â€” Coni Dalal <strong>vs</strong> Vale H Isi</td>
        <td>
          <label class="match-label"><input type="radio" name="match4" value="Coni Dalal"> Coni Dalal</label>
          <label class="match-label"><input type="radio" name="match4" value="Vale H Isi"> Vale H Isi</label>
        </td>
      </tr>

      <tr>
        <td class="court">Cancha 2</td>
        <td><span class="time">18:35 - 19:00</span> â€” Isa Dani Torres <strong>vs</strong> Pia MaÃ±i</td>
        <td>
          <label class="match-label"><input type="radio" name="match5" value="Isa Dani Torres"> Isa Dani Torres</label>
          <label class="match-label"><input type="radio" name="match5" value="Pia MaÃ±i"> Pia MaÃ±i</label>
        </td>
      </tr>

      <tr>
        <td class="court">Cancha 3</td>
        <td><span class="time">18:35 - 19:00</span> â€” Cata Flo <strong>vs</strong> Nata Fi</td>
        <td>
          <label class="match-label"><input type="radio" name="match6" value="Cata Flo"> Cata Flo</label>
          <label class="match-label"><input type="radio" name="match6" value="Nata Fi"> Nata Fi</label>
        </td>
      </tr>
    </table></div>

  <div class="round"><h2>Franja 19:05 - 19:30</h2><table><tr><th>Cancha</th><th>Partido</th><th>Tu voto</th></tr>
      <tr>
        <td class="court">Cancha 1</td>
        <td><span class="time">19:05 - 19:30</span> â€” Coni Dalal <strong>vs</strong> Cata Flo</td>
        <td>
          <label class="match-label"><input type="radio" name="match7" value="Coni Dalal"> Coni Dalal</label>
          <label class="match-label"><input type="radio" name="match7" value="Cata Flo"> Cata Flo</label>
        </td>
      </tr>

      <tr>
        <td class="court">Cancha 2</td>
        <td><span class="time">19:05 - 19:30</span> â€” Isa Dani Torres <strong>vs</strong> Nata Fi</td>
        <td>
          <label class="match-label"><input type="radio" name="match8" value="Isa Dani Torres"> Isa Dani Torres</label>
          <label class="match-label"><input type="radio" name="match8" value="Nata Fi"> Nata Fi</label>
        </td>
      </tr>

      <tr>
        <td class="court">Cancha 3</td>
        <td><span class="time">19:05 - 19:30</span> â€” Vale H Isi <strong>vs</strong> Pia MaÃ±i</td>
        <td>
          <label class="match-label"><input type="radio" name="match9" value="Vale H Isi"> Vale H Isi</label>
          <label class="match-label"><input type="radio" name="match9" value="Pia MaÃ±i"> Pia MaÃ±i</label>
        </td>
      </tr>
    </table></div>

  <div class="round"><h2>Franja 19:35 - 20:00</h2><table><tr><th>Cancha</th><th>Partido</th><th>Tu voto</th></tr>
      <tr>
        <td class="court">Cancha 1</td>
        <td><span class="time">19:35 - 20:00</span> â€” Coni Dalal <strong>vs</strong> Nata Fi</td>
        <td>
          <label class="match-label"><input type="radio" name="match10" value="Coni Dalal"> Coni Dalal</label>
          <label class="match-label"><input type="radio" name="match10" value="Nata Fi"> Nata Fi</label>
        </td>
      </tr>

      <tr>
        <td class="court">Cancha 2</td>
        <td><span class="time">19:35 - 20:00</span> â€” Isa Dani Torres <strong>vs</strong> Vale H Isi</td>
        <td>
          <label class="match-label"><input type="radio" name="match11" value="Isa Dani Torres"> Isa Dani Torres</label>
          <label class="match-label"><input type="radio" name="match11" value="Vale H Isi"> Vale H Isi</label>
        </td>
      </tr>

      <tr>
        <td class="court">Cancha 3</td>
        <td><span class="time">19:35 - 20:00</span> â€” Cata Flo <strong>vs</strong> Pia MaÃ±i</td>
        <td>
          <label class="match-label"><input type="radio" name="match12" value="Cata Flo"> Cata Flo</label>
          <label class="match-label"><input type="radio" name="match12" value="Pia MaÃ±i"> Pia MaÃ±i</label>
        </td>
      </tr>
    </table></div>

  <div class="round"><h2>Franja 20:05 - 20:30</h2><table><tr><th>Cancha</th><th>Partido</th><th>Tu voto</th></tr>
      <tr>
        <td class="court">Cancha 1</td>
        <td><span class="time">20:05 - 20:30</span> â€” Coni Dalal <strong>vs</strong> Pia MaÃ±i</td>
        <td>
          <label class="match-label"><input type="radio" name="match13" value="Coni Dalal"> Coni Dalal</label>
          <label class="match-label"><input type="radio" name="match13" value="Pia MaÃ±i"> Pia MaÃ±i</label>
        </td>
      </tr>

      <tr>
        <td class="court">Cancha 2</td>
        <td><span class="time">20:05 - 20:30</span> â€” Isa Dani Torres <strong>vs</strong> Cata Flo</td>
        <td>
          <label class="match-label"><input type="radio" name="match14" value="Isa Dani Torres"> Isa Dani Torres</label>
          <label class="match-label"><input type="radio" name="match14" value="Cata Flo"> Cata Flo</label>
        </td>
      </tr>

      <tr>
        <td class="court">Cancha 3</td>
        <td><span class="time">20:05 - 20:30</span> â€” Vale H Isi <strong>vs</strong> Nata Fi</td>
        <td>
          <label class="match-label"><input type="radio" name="match15" value="Vale H Isi"> Vale H Isi</label>
          <label class="match-label"><input type="radio" name="match15" value="Nata Fi"> Nata Fi</label>
        </td>
      </tr>
    </table></div>

  <button id="submitVoteButton">Enviar votos</button>

  <!-- Carrusel de fotos debajo de los votos -->
  <section class="round" id="galeria">
    <h2>GalerÃ­a</h2>
    <div class="carousel">
      <button id="prevPhoto" aria-label="Anterior">â—€</button>
      <img id="slidePhoto" src="" alt="foto" />
      <button id="nextPhoto" aria-label="Siguiente">â–¶</button>
    </div>
  </section>

  <!-- ===================== RESULTADOS REALES & RANKING (OCULTOS POR CLAVE) ===================== -->
  <button id="toggleResultadosBtn" style="margin-top:8px;">Mostrar resultados</button>

  <section class="round hidden" id="resultados-reales">
    <h2>Cargar resultados reales</h2>
    <p>Una vez terminados los partidos, selecciona a la pareja ganadora en cada match y calcula el ranking.</p>

    <table id="tablaResultados">
      <thead>
        <tr>
          <th>#</th>
          <th>Partido</th>
          <th>Ganadora real</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button id="btnCalcularGanadoras">Calcular ranking de aciertos</button>

    <div id="rankingContainer" style="margin-top:18px;"></div>
  </section>

  <script>
    /*********** EnvÃ­o de votos ***********/
    document.getElementById("submitVoteButton").addEventListener("click", function() {
      const voterName = document.getElementById("voterName").value.trim();
      const votes = { "name": voterName };
      const totalMatches = 15;
      for (let i=1;i<=totalMatches;i++) {
        const choice = document.querySelector('input[name="match'+i+'"]:checked');
        votes['match'+i] = choice ? choice.value : undefined;
      }
      if (!voterName) { alert("Ingresa tu nombre ðŸ˜…"); return; }
      if (Object.values(votes).some(v => v === undefined)) { alert("Te faltan partidos por votar"); return; }
      fetch("https://script.google.com/macros/s/AKfycbwtF9QzOBwyUgEqEjLffuj6zVCfoKzUraqMRlYro_CK_ASVrsFXzf8QTwDkm09liZ-AyQ/exec", {
        method:"POST", mode:"no-cors", headers:{"Content-Type":"application/json"}, body: JSON.stringify(votes)
      })
      .then(() => alert("Â¡Votos enviados! Gracias ðŸ’™"))
      .catch(() => alert("Â¡Votos enviados! Gracias ðŸ’™"));
    });

    /*********** Construir tabla de resultados reales ***********/
    const TOTAL_MATCHES = 15;

    function getMatchOptions(i){
      const radios = document.querySelectorAll('input[name="match'+i+'"]');
      const opts = Array.from(radios).map(r => r.value);
      return opts.length === 2 ? opts : ["OpciÃ³n A","OpciÃ³n B"];
    }

    function buildResultadosTable(){
      const tbody = document.querySelector("#tablaResultados tbody");
      tbody.innerHTML = "";
      for(let i=1;i<=TOTAL_MATCHES;i++){
        const [optA,optB] = getMatchOptions(i);
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${i}</td>
          <td>${optA} <strong>vs</strong> ${optB}</td>
          <td>
            <label style="margin-right:12px;">
              <input type="radio" name="real${i}" value="${optA}"> ${optA}
            </label>
            <label>
              <input type="radio" name="real${i}" value="${optB}"> ${optB}
            </label>
          </td>
        `;
        tbody.appendChild(row);
      }
    }

    /*********** Ranking de aciertos (lectura) ***********/
    const READ_URL = "https://script.google.com/macros/s/AKfycbwtF9QzOBwyUgEqEjLffuj6zVCfoKzUraqMRlYro_CK_ASVrsFXzf8QTwDkm09liZ-AyQ/exec?mode=read";

    async function fetchAllVotes(){
      const res = await fetch(READ_URL, {method:"GET", mode:"cors"});
      if(!res.ok) throw new Error("No se pudo leer votos (GET)");
      return await res.json();
    }

    function collectRealWinners(){
      const real = {};
      for(let i=1;i<=TOTAL_MATCHES;i++){
        const ch = document.querySelector('input[name="real'+i+'"]:checked');
        if(!ch) return null;
        real['match'+i] = ch.value;
      }
      return real;
    }

    function scoreOne(voterObj, real){
      let score = 0;
      for(let i=1;i<=TOTAL_MATCHES;i++){
        if(voterObj['match'+i] && voterObj['match'+i] === real['match'+i]) score++;
      }
      return score;
    }

    function renderRanking(rows){
      const div = document.getElementById("rankingContainer");
      if(!rows.length){ div.innerHTML = "<p>No hay votos registrados aÃºn.</p>"; return; }

      const table = document.createElement("table");
      table.innerHTML = `
        <thead>
          <tr><th>#</th><th>Nombre</th><th>Aciertos</th></tr>
        </thead>
        <tbody></tbody>
      `;
      const tb = table.querySelector("tbody");

      rows.forEach((r,i)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${i+1}</td><td>${r.name || "(sin nombre)"}</td><td>${r.score}</td>`;
        tb.appendChild(tr);
      });

      const max = rows[0].score;
      const ganadores = rows.filter(r => r.score === max).map(r => r.name || "(sin nombre)");
      div.innerHTML = `<h3>Ranking</h3><p><strong>Ganador/a(s):</strong> ${ganadores.join(", ")} â€” ${max} aciertos</p>`;
      div.appendChild(table);
    }

    document.getElementById("btnCalcularGanadoras").addEventListener("click", async ()=>{
      const reales = collectRealWinners();
      if(!reales){ alert("Te faltan resultados por marcar."); return; }
      try{
        const votos = await fetchAllVotes();
        const scored = votos.map(v => ({...v, score: scoreOne(v, reales)}))
                            .sort((a,b)=> b.score - a.score || (a.name||"").localeCompare(b.name||""));
        renderRanking(scored);
      }catch(err){
        console.error(err);
        alert("No pude leer los votos guardados. Revisa el endpoint READ_URL.");
      }
    });

    // Inicializa la tabla de resultados reales
    buildResultadosTable();

    /*********** Clave para mostrar/ocultar resultados ***********/
    const ADMIN_CODE = "m3power"; // <-- cÃ¡mbiala
    function showResultados(){ document.getElementById('resultados-reales')?.classList.remove('hidden'); }
    function hideResultados(){ document.getElementById('resultados-reales')?.classList.add('hidden'); }
    hideResultados(); // oculto por defecto

    document.getElementById('toggleResultadosBtn')?.addEventListener('click', ()=>{
      const sec = document.getElementById('resultados-reales');
      if (!sec) return;
      // toggle si ya estÃ¡ visible
      if (!sec.classList.contains('hidden')) { hideResultados(); return; }
      // pedir clave si estÃ¡ oculto
      const code = prompt("Ingresa la clave de admin:");
      if (code && code === ADMIN_CODE) {
        showResultados();
      } else {
        alert("Clave incorrecta.");
      }
    });

    /*********** Carrusel (auto-descubrimiento pictures/photo1..photo30) ***********/
    // Si prefieres lista manual, descomenta y rellena:
    // const PHOTO_FILES = ["pictures/cata.jpg","pictures/barbi.jpg","pictures/flo.jpg"];
    const PHOTO_FILES = [];
    const MAX_PROBE = 30;
    const EXTS = ["jpg","jpeg","png","webp"];
    let pendingProbes = 0, anyFound = false;

    function tryAdd(src, onDone){
      const img = new Image();
      img.onload = ()=>{ PHOTO_FILES.push(src); onDone(true); };
      img.onerror = ()=> onDone(false);
      img.src = src + (src.includes('?') ? '' : `?v=${Date.now()}`); // evita cachÃ©
    }
    function autoDiscoverPhotos(callback){
      pendingProbes = 0; anyFound = false;
      for (let i=1;i<=MAX_PROBE;i++){
        for (const ext of EXTS){
          const src = `pictures/photo${i}.${ext}`;
          pendingProbes++;
          tryAdd(src, (ok)=>{
            if (ok) anyFound = true;
            pendingProbes--;
            if (pendingProbes===0) callback(anyFound);
          });
        }
      }
    }

    const slide = document.getElementById('slidePhoto');
    const prevBtn = document.getElementById('prevPhoto');
    const nextBtn = document.getElementById('nextPhoto');
    let idx = 0, timerId = null;

    function showIdx(i){
      if (!PHOTO_FILES.length) return;
      idx = (i + PHOTO_FILES.length) % PHOTO_FILES.length;
      slide.src = PHOTO_FILES[idx];
    }
    function startAuto(){
      stopAuto();
      timerId = setInterval(()=> showIdx(idx+1), 2500);
    }
    function stopAuto(){
      if (timerId) clearInterval(timerId);
      timerId = null;
    }

    prevBtn?.addEventListener('click', ()=>{ stopAuto(); showIdx(idx-1); startAuto(); });
    nextBtn?.addEventListener('click', ()=>{ stopAuto(); showIdx(idx+1); startAuto(); });

    (function initGallery(){
      if (PHOTO_FILES.length){
        showIdx(0); startAuto();
        return;
      }
      autoDiscoverPhotos((found)=>{
        if (!found){
          document.getElementById('galeria').classList.add('hidden');
          return;
        }
        showIdx(0); startAuto();
      });
    })();
  </script>
</body>
</html>
